var Nn=Object.defineProperty;var zn=(R,a,h)=>a in R?Nn(R,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):R[a]=h;var P=(R,a,h)=>(zn(R,typeof a!="symbol"?a+"":a,h),h),ft=(R,a,h)=>{if(!a.has(R))throw TypeError("Cannot "+h)};var p=(R,a,h)=>(ft(R,a,"read from private field"),h?h.call(R):a.get(R)),H=(R,a,h)=>{if(a.has(R))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(R):a.set(R,h)},te=(R,a,h,b)=>(ft(R,a,"write to private field"),b?b.call(R,h):a.set(R,h),h);var dt=(R,a,h)=>(ft(R,a,"access private method"),h);import"./app-d2e00ec3.js";import{M as Bt,c as Ae,g as de,L as Ft,a as ze,b as Bn,d as Fn,e as Ve,G as kn,A as Un,S as Be,f as vt,s as Yn,P as $n}from"./setting-40815ffc.js";import{i as Hn}from"./readme-e506e057.js";const Xn="index.json",Wn="index.map.json",jn="./data/xmmt.dituon.petpet";class Vn{constructor(a){P(this,"urls");P(this,"urlSet",new Set);P(this,"initPromise");P(this,"idMap");P(this,"lengthMap",new Map);P(this,"aliasMap",new Map);P(this,"fonts");P(this,"fontPromises",[]);this.urls=[...new Set(a)],this.initPromise=this.init()}async init(){const a=new Map,h=new Map;await Promise.allSettled(this.urls.map(async b=>{const M=await fetch(`${b}/${Xn}`).then(O=>O.json()),{dataPath:L=jn,dataList:B,fontList:N}=M;try{const O=await fetch(`${b}/${Wn}`).then(U=>U.json());Object.entries(O.length).forEach(([U,q])=>this.lengthMap.set(U,q)),Object.entries(O.alias).forEach(([U,q])=>this.aliasMap.set(U,q))}catch{console.warn(`cannot find index.map.json in ${b} `)}for(const O of B)a.has(O)||a.set(O,`${b}/${L}/${O}`);for(const O of N)h.has(O)||h.set(O,`${b}/${L}/fonts/${O}`);this.urlSet.add(b)})),this.idMap=a;for(let[b,M]of h){b=b.split(".")[0],console.log(b,M);const L=new FontFace(b,`url(${M})`);this.fontPromises.push(L.load().then(B=>{document.fonts.add(B)}))}}async getIdMap(){return await this.initPromise,this.idMap}async getLengthMap(){return await this.initPromise,this.lengthMap}async getPreviewList(){const a=await this.getIdMap(),h=[];for(const[b,M]of a.entries())h.push({key:b,url:M,alias:this.aliasMap.get(b)});return h}async getFonts(){return await this.initPromise,await Promise.all(this.fontPromises),this.fonts}async getUrlSet(){return await this.initPromise,this.urlSet}}var se,Fe,ke,Ie,be,Ee;const Ce=class{constructor(a){H(this,se,document.createElement("div"));H(this,Fe,void 0);H(this,ke,new Map);H(this,Ie,void 0);H(this,be,void 0);H(this,Ee,0);P(this,"mask",new Bt);p(this,se).classList.add("modal-select","hide",Ce.ICON_SIZE_LIST[p(this,Ee)]),p(this,se).addEventListener("contextmenu",h=>{h.preventDefault(),this.changeIconSize()}),document.body.appendChild(p(this,se)),this.mask.onclick=()=>{p(this,be)&&p(this,be).call(this,null),this.hide()},a&&(this.templates=a)}set templates(a){te(this,Fe,a);const h=document.createElement("div");h.className="index-list",te(this,Ie,h);for(const M of a){const L=document.createElement("div"),B=document.createElement("img");B.src=`${M.url}/0.png`,B.alt=M.key,B.onerror=()=>L.remove(),B.loading="lazy";const N=Ae(M.key);M.alias&&M.alias.forEach(O=>N.appendChild(Ae(O,"span"))),L.append(B,N),L.addEventListener("click",async O=>{p(this,be).call(this,await kt(M)),this.hide()}),p(this,ke).set(M,L),h.appendChild(L)}const b=document.createElement("input");b.placeholder=`ðŸ” ${de().typeToSearch} / ${de().rightClickOrLongPress}`,b.addEventListener("change",M=>{this.search(b.value.trim())}),p(this,se).append(b,h)}hide(){this.mask.hide(),p(this,se).classList.add("hide")}async show(){return p(this,Fe)?(this.mask.show(),p(this,se)&&p(this,se).classList.remove("hide"),new Promise(a=>te(this,be,a))):null}changeIconSize(){const a=(p(this,Ee)+1)%Ce.ICON_SIZE_LIST.length;p(this,se).classList.replace(Ce.ICON_SIZE_LIST[p(this,Ee)],Ce.ICON_SIZE_LIST[a]),te(this,Ee,a)}search(a){p(this,Ie).innerHTML="";for(let[h,b]of p(this,ke).entries()){const{key:M,alias:L}=h;!M.includes(a)&&!(L&&L.find(B=>B.includes(a)))||p(this,Ie).appendChild(b)}}};let Ge=Ce;se=new WeakMap,Fe=new WeakMap,ke=new WeakMap,Ie=new WeakMap,be=new WeakMap,Ee=new WeakMap,P(Ge,"ICON_SIZE_LIST",["big","medium","small"]);async function kt(R){if(R.type)return R;const a=await fetch(R.url+"/data.json").then(h=>h.json());return{...R,...a}}var ce,Me,Ue,Te;class Gn{constructor(a){H(this,ce,document.createElement("div"));H(this,Me,void 0);H(this,Ue,void 0);P(this,"loading",new Ft(p(this,ce)));H(this,Te,void 0);P(this,"template");if(te(this,Me,new Ge(a)),p(this,ce).classList.add("template-chooser"),p(this,ce).textContent=de().notSelected,p(this,ce).addEventListener("click",async()=>{const h=await this.showModal();p(this,Te)&&p(this,Te).call(this,h)}),!a){this.loading.show();return}this.templates=a}set templates(a){this.loading.hide(),te(this,Ue,a),p(this,Me).templates=a}async setTemplate(a){if(!a)return;const h=p(this,Ue).find(b=>b.key===a);if(!h)throw new Error(`key ${a} not found`);p(this,ce).textContent=h.key,this.template=await kt(h)}get templateKey(){var a;return(a=this.template)==null?void 0:a.key}render(){const a=document.createElement("div");return a.append(Ae(de().selectTemplate),p(this,ce)),a}async showModal(){const a=await p(this,Me).show();return a&&(p(this,ce).textContent=a.key,this.template=a),a??this.template}set onchange(a){te(this,Te,a)}}ce=new WeakMap,Me=new WeakMap,Ue=new WeakMap,Te=new WeakMap;var Ut={exports:{}};(function(R,a){(function(h,b){R.exports=b()})(ze,function(){(function(){for(var S=0,c=["ms","moz","webkit","o"],i=0;i<c.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[c[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[i]+"CancelAnimationFrame"]||window[c[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(l,f){var u=new Date().getTime(),m=Math.max(0,16-(u-S)),w=window.setTimeout(function(){l(u+m)},m);return S=u+m,w}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(l){clearTimeout(l)})})(),function(){if(typeof window.CustomEvent=="function")return!1;function S(c,i){i=i||{bubbles:!1,cancelable:!1,detail:void 0};var l=document.createEvent("CustomEvent");return l.initCustomEvent(c,i.bubbles,i.cancelable,i.detail),l}S.prototype=window.Event.prototype,window.CustomEvent=S}(),function(S){try{return new CustomEvent("test"),!1}catch{}function c(i,l){l=l||{bubbles:!1,cancelable:!1};var f=document.createEvent("MouseEvent");return f.initMouseEvent(i,l.bubbles,l.cancelable,S,0,0,0,0,0,!1,!1,!1,!1,0,null),f}c.prototype=Event.prototype,S.MouseEvent=c}(window);var h=function(S,c){if(!(S instanceof c))throw new TypeError("Cannot call a class as a function")},b=function(){function S(c,i){for(var l=0;l<i.length;l++){var f=i[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}return function(c,i,l){return i&&S(c.prototype,i),l&&S(c,l),c}}(),M=function S(c,i,l){c===null&&(c=Function.prototype);var f=Object.getOwnPropertyDescriptor(c,i);if(f===void 0){var u=Object.getPrototypeOf(c);return u===null?void 0:S(u,i,l)}else{if("value"in f)return f.value;var m=f.get;return m===void 0?void 0:m.call(l)}},L=function(S,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);S.prototype=Object.create(c&&c.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(S,c):S.__proto__=c)},B=function(S,c){if(!S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c&&(typeof c=="object"||typeof c=="function")?c:S},N=function(){function S(c,i){var l=[],f=!0,u=!1,m=void 0;try{for(var w=c[Symbol.iterator](),_;!(f=(_=w.next()).done)&&(l.push(_.value),!(i&&l.length===i));f=!0);}catch(I){u=!0,m=I}finally{try{!f&&w.return&&w.return()}finally{if(u)throw m}}return l}return function(c,i){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c))return S(c,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),O=function S(c,i,l,f){h(this,S);var u=this;this.position=c,this.constraints=i,this.cursor=l,this.eventBus=f,this.el=document.createElement("div"),this.el.className="croppr-handle",this.el.style.cursor=l,this.el.addEventListener("mousedown",m);function m(I){I.stopPropagation(),document.addEventListener("mouseup",w),document.addEventListener("mousemove",_),u.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:u}}))}function w(I){I.stopPropagation(),document.removeEventListener("mouseup",w),document.removeEventListener("mousemove",_),u.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{handle:u}}))}function _(I){I.stopPropagation(),u.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:I.clientX,mouseY:I.clientY}}))}},U=function(){function S(c,i,l,f){h(this,S),this.x1=c,this.y1=i,this.x2=l,this.y2=f}return b(S,[{key:"set",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return this.x1=i??this.x1,this.y1=l??this.y1,this.x2=f??this.x2,this.y2=u??this.y2,this}},{key:"width",value:function(){return Math.abs(this.x2-this.x1)}},{key:"height",value:function(){return Math.abs(this.y2-this.y1)}},{key:"resize",value:function(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0],u=this.x1+this.width()*f[0],m=this.y1+this.height()*f[1];return this.x1=u-i*f[0],this.y1=m-l*f[1],this.x2=this.x1+i,this.y2=this.y1+l,this}},{key:"scale",value:function(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],f=this.width()*i,u=this.height()*i;return this.resize(f,u,l),this}},{key:"move",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,f=this.width(),u=this.height();return i=i===null?this.x1:i,l=l===null?this.y1:l,this.x1=i,this.y1=l,this.x2=i+f,this.y2=l+u,this}},{key:"getRelativePoint",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0],l=this.width()*i[0],f=this.height()*i[1];return[l,f]}},{key:"getAbsolutePoint",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0],l=this.x1+this.width()*i[0],f=this.y1+this.height()*i[1];return[l,f]}},{key:"constrainToRatio",value:function(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"height";if(i!==null){switch(this.width(),this.height(),f){case"height":this.resize(this.width(),this.width()*i,l);break;case"width":this.resize(this.height()*1/i,this.height(),l);break;default:this.resize(this.width(),this.width()*i,l)}return this}}},{key:"constrainToBoundary",value:function(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0],u=this.getAbsolutePoint(f),m=N(u,2),w=m[0],_=m[1],I=w,z=_,A=i-w,F=l-_,X=-2*f[0]+1,j=-2*f[1]+1,k=null,Z=null;switch(X){case-1:k=I;break;case 0:k=Math.min(I,A)*2;break;case 1:k=A;break}switch(j){case-1:Z=z;break;case 0:Z=Math.min(z,F)*2;break;case 1:Z=F;break}if(this.width()>k){var G=k/this.width();this.scale(G,f)}if(this.height()>Z){var J=Z/this.height();this.scale(J,f)}return this}},{key:"constrainToSize",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0,0],w=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(w&&(w>1?(i=l*1/w,u=u*w):w<1&&(l=i*w,f=u*1/w)),i&&this.width()>i){var _=i,I=w===null?this.height():l;this.resize(_,I,m)}if(l&&this.height()>l){var z=w===null?this.width():i,A=l;this.resize(z,A,m)}if(f&&this.width()<f){var F=f,X=w===null?this.height():u;this.resize(F,X,m)}if(u&&this.height()<u){var j=w===null?this.width():f,k=u;this.resize(j,k,m)}return this}}]),S}();function q(S){S.addEventListener("touchstart",x),S.addEventListener("touchend",x),S.addEventListener("touchmove",x)}function x(S){S.preventDefault();var c=S.changedTouches[0],i={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};c.target.dispatchEvent(new MouseEvent(i[S.type],{bubbles:!0,cancelable:!0,view:window,clientX:c.clientX,clientY:c.clientY,screenX:c.screenX,screenY:c.screenY}))}var T=[{position:[0,0],constraints:[1,0,0,1],cursor:"nw-resize"},{position:[.5,0],constraints:[1,0,0,0],cursor:"n-resize"},{position:[1,0],constraints:[1,1,0,0],cursor:"ne-resize"},{position:[1,.5],constraints:[0,1,0,0],cursor:"e-resize"},{position:[1,1],constraints:[0,1,1,0],cursor:"se-resize"},{position:[.5,1],constraints:[0,0,1,0],cursor:"s-resize"},{position:[0,1],constraints:[0,0,1,1],cursor:"sw-resize"},{position:[0,.5],constraints:[0,0,0,1],cursor:"w-resize"}],V=function(){function S(c,i){var l=this,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(h(this,S),this.options=S.parseOptions(i||{}),!c.nodeName&&(c=document.querySelector(c),c==null))throw"Unable to find element.";if(!c.getAttribute("src"))throw"Image src not provided.";this._initialized=!1,this._restore={parent:c.parentNode,element:c},f||(c.width===0||c.height===0?c.onload=function(){l.initialize(c)}:this.initialize(c))}return b(S,[{key:"initialize",value:function(i){this.createDOM(i),this.options.convertToPixels(this.cropperEl),this.attachHandlerEvents(),this.attachRegionEvents(),this.attachOverlayEvents(),this.box=this.initializeBox(this.options),this.redraw(),this._initialized=!0,this.options.onInitialize!==null&&this.options.onInitialize(this)}},{key:"createDOM",value:function(i){this.containerEl=document.createElement("div"),this.containerEl.className="croppr-container",this.eventBus=this.containerEl,q(this.containerEl),this.cropperEl=document.createElement("div"),this.cropperEl.className="croppr",this.imageEl=document.createElement("img"),this.imageEl.setAttribute("src",i.getAttribute("src")),this.imageEl.setAttribute("alt",i.getAttribute("alt")),this.imageEl.className="croppr-image",this.imageClippedEl=this.imageEl.cloneNode(),this.imageClippedEl.className="croppr-imageClipped",this.regionEl=document.createElement("div"),this.regionEl.className="croppr-region",this.overlayEl=document.createElement("div"),this.overlayEl.className="croppr-overlay";var l=document.createElement("div");l.className="croppr-handleContainer",this.handles=[];for(var f=0;f<T.length;f++){var u=new O(T[f].position,T[f].constraints,T[f].cursor,this.eventBus);this.handles.push(u),l.appendChild(u.el)}this.cropperEl.appendChild(this.imageEl),this.cropperEl.appendChild(this.imageClippedEl),this.cropperEl.appendChild(this.regionEl),this.cropperEl.appendChild(this.overlayEl),this.cropperEl.appendChild(l),this.containerEl.appendChild(this.cropperEl),i.parentElement.replaceChild(this.containerEl,i)}},{key:"setImage",value:function(i){var l=this;return this.imageEl.onload=function(){l.box=l.initializeBox(l.options),l.redraw()},this.imageEl.src=i,this.imageClippedEl.src=i,this}},{key:"destroy",value:function(){this._restore.parent.replaceChild(this._restore.element,this.containerEl)}},{key:"initializeBox",value:function(i){var l=i.startSize.width,f=i.startSize.height,u=new U(0,0,l,f);u.constrainToRatio(i.aspectRatio,[.5,.5]);var m=i.minSize,w=i.maxSize;u.constrainToSize(w.width,w.height,m.width,m.height,[.5,.5],i.aspectRatio);var _=this.cropperEl.offsetWidth,I=this.cropperEl.offsetHeight;u.constrainToBoundary(_,I,[.5,.5]);var z=this.cropperEl.offsetWidth/2-u.width()/2,A=this.cropperEl.offsetHeight/2-u.height()/2;return u.move(z,A),u}},{key:"redraw",value:function(){var i=this,l=Math.round(this.box.width()),f=Math.round(this.box.height()),u=Math.round(this.box.x1),m=Math.round(this.box.y1),w=Math.round(this.box.x2),_=Math.round(this.box.y2);window.requestAnimationFrame(function(){i.regionEl.style.transform="translate("+u+"px, "+m+"px)",i.regionEl.style.width=l+"px",i.regionEl.style.height=f+"px",i.imageClippedEl.style.clip="rect("+m+"px, "+w+"px, "+_+"px, "+u+"px)";for(var I=i.box.getAbsolutePoint([.5,.5]),z=I[0]-i.cropperEl.offsetWidth/2>>31,A=I[1]-i.cropperEl.offsetHeight/2>>31,F=(z^A)+A+A+4,X=-2*F+8,j=0;j<i.handles.length;j++){var k=i.handles[j],Z=k.el.offsetWidth,G=k.el.offsetHeight,J=u+l*k.position[0]-Z/2,ae=m+f*k.position[1]-G/2;k.el.style.transform="translate("+Math.round(J)+"px, "+Math.round(ae)+"px)",k.el.style.zIndex=X==j?5:4}})}},{key:"attachHandlerEvents",value:function(){var i=this.eventBus;i.addEventListener("handlestart",this.onHandleMoveStart.bind(this)),i.addEventListener("handlemove",this.onHandleMoveMoving.bind(this)),i.addEventListener("handleend",this.onHandleMoveEnd.bind(this))}},{key:"attachRegionEvents",value:function(){var i=this.eventBus;this.regionEl.addEventListener("mousedown",l),i.addEventListener("regionstart",this.onRegionMoveStart.bind(this)),i.addEventListener("regionmove",this.onRegionMoveMoving.bind(this)),i.addEventListener("regionend",this.onRegionMoveEnd.bind(this));function l(m){m.stopPropagation(),document.addEventListener("mouseup",u),document.addEventListener("mousemove",f),i.dispatchEvent(new CustomEvent("regionstart",{detail:{mouseX:m.clientX,mouseY:m.clientY}}))}function f(m){m.stopPropagation(),i.dispatchEvent(new CustomEvent("regionmove",{detail:{mouseX:m.clientX,mouseY:m.clientY}}))}function u(m){m.stopPropagation(),document.removeEventListener("mouseup",u),document.removeEventListener("mousemove",f),i.dispatchEvent(new CustomEvent("regionend",{detail:{mouseX:m.clientX,mouseY:m.clientY}}))}}},{key:"attachOverlayEvents",value:function(){var i=4,l=this,f=null;this.overlayEl.addEventListener("mousedown",u);function u(_){_.stopPropagation(),document.addEventListener("mouseup",w),document.addEventListener("mousemove",m);var I=l.cropperEl.getBoundingClientRect(),z=_.clientX-I.left,A=_.clientY-I.top;f=l.box,l.box=new U(z,A,z+1,A+1),l.eventBus.dispatchEvent(new CustomEvent("handlestart",{detail:{handle:l.handles[i]}}))}function m(_){_.stopPropagation(),l.eventBus.dispatchEvent(new CustomEvent("handlemove",{detail:{mouseX:_.clientX,mouseY:_.clientY}}))}function w(_){if(_.stopPropagation(),document.removeEventListener("mouseup",w),document.removeEventListener("mousemove",m),l.box.width()===1&&l.box.height()===1){l.box=f;return}l.eventBus.dispatchEvent(new CustomEvent("handleend",{detail:{mouseX:_.clientX,mouseY:_.clientY}}))}}},{key:"onHandleMoveStart",value:function(i){var l=i.detail.handle,f=[1-l.position[0],1-l.position[1]],u=this.box.getAbsolutePoint(f),m=N(u,2),w=m[0],_=m[1];this.activeHandle={handle:l,originPoint:f,originX:w,originY:_},this.options.onCropStart!==null&&this.options.onCropStart(this.getValue())}},{key:"onHandleMoveMoving",value:function(i){var l=i.detail,f=l.mouseX,u=l.mouseY,m=this.cropperEl.getBoundingClientRect();f=f-m.left,u=u-m.top,f<0?f=0:f>m.width&&(f=m.width),u<0?u=0:u>m.height&&(u=m.height);var w=this.activeHandle.originPoint.slice(),_=this.activeHandle.originX,I=this.activeHandle.originY,z=this.activeHandle.handle,A=z.constraints[0]===1,F=z.constraints[1]===1,X=z.constraints[2]===1,j=z.constraints[3]===1,k=(j||F)&&(A||X),Z=j||F?_:this.box.x1,G=j||F?_:this.box.x2,J=A||X?I:this.box.y1,ae=A||X?I:this.box.y2;Z=j?f:Z,G=F?f:G,J=A?u:J,ae=X?u:ae;var we=!1,ee=!1;if((j||F)&&(we=j?f>_:f<_),(A||X)&&(ee=A?u>I:u<I),we){var ne=Z;Z=G,G=ne,w[0]=1-w[0]}if(ee){var Je=J;J=ae,ae=Je,w[1]=1-w[1]}var le=new U(Z,J,G,ae);if(this.options.aspectRatio){var Pe=this.options.aspectRatio,Oe=!1;k?Oe=u>le.y1+Pe*le.width()||u<le.y2-Pe*le.width():(A||X)&&(Oe=!0);var et=Oe?"width":"height";le.constrainToRatio(Pe,w,et)}var He=this.options.minSize,Xe=this.options.maxSize;le.constrainToSize(Xe.width,Xe.height,He.width,He.height,w,this.options.aspectRatio);var tt=this.cropperEl.offsetWidth,nt=this.cropperEl.offsetHeight;le.constrainToBoundary(tt,nt,w),this.box=le,this.redraw(),this.options.onCropMove!==null&&this.options.onCropMove(this.getValue())}},{key:"onHandleMoveEnd",value:function(i){this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue())}},{key:"onRegionMoveStart",value:function(i){var l=i.detail,f=l.mouseX,u=l.mouseY,m=this.cropperEl.getBoundingClientRect();f=f-m.left,u=u-m.top,this.currentMove={offsetX:f-this.box.x1,offsetY:u-this.box.y1},this.options.onCropStart!==null&&this.options.onCropStart(this.getValue())}},{key:"onRegionMoveMoving",value:function(i){var l=i.detail,f=l.mouseX,u=l.mouseY,m=this.currentMove,w=m.offsetX,_=m.offsetY,I=this.cropperEl.getBoundingClientRect();f=f-I.left,u=u-I.top,this.box.move(f-w,u-_),this.box.x1<0&&this.box.move(0,null),this.box.x2>I.width&&this.box.move(I.width-this.box.width(),null),this.box.y1<0&&this.box.move(null,0),this.box.y2>I.height&&this.box.move(null,I.height-this.box.height()),this.redraw(),this.options.onCropMove!==null&&this.options.onCropMove(this.getValue())}},{key:"onRegionMoveEnd",value:function(i){this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue())}},{key:"getValue",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(i===null&&(i=this.options.returnMode),i=="real"){var l=this.imageEl.naturalWidth,f=this.imageEl.naturalHeight,u=this.imageEl.getBoundingClientRect(),m=u.width,w=u.height,_=l/m,I=f/w;return{x:Math.round(this.box.x1*_),y:Math.round(this.box.y1*I),width:Math.round(this.box.width()*_),height:Math.round(this.box.height()*I)}}else if(i=="ratio"){var z=this.imageEl.getBoundingClientRect(),A=z.width,F=z.height;return{x:W(this.box.x1/A,3),y:W(this.box.y1/F,3),width:W(this.box.width()/A,3),height:W(this.box.height()/F,3)}}else if(i=="raw")return{x:Math.round(this.box.x1),y:Math.round(this.box.y1),width:Math.round(this.box.width()),height:Math.round(this.box.height())}}}],[{key:"parseOptions",value:function(i){var l={aspectRatio:null,maxSize:{width:null,height:null},minSize:{width:null,height:null},startSize:{width:100,height:100,unit:"%"},returnMode:"real",onInitialize:null,onCropStart:null,onCropMove:null,onCropEnd:null},f=null;i.aspectRatio!==void 0&&(typeof i.aspectRatio=="number"?f=i.aspectRatio:i.aspectRatio instanceof Array&&(f=i.aspectRatio[1]/i.aspectRatio[0]));var u=null;i.maxSize!==void 0&&i.maxSize!==null&&(u={width:i.maxSize[0]||null,height:i.maxSize[1]||null,unit:i.maxSize[2]||"px"});var m=null;i.minSize!==void 0&&i.minSize!==null&&(m={width:i.minSize[0]||null,height:i.minSize[1]||null,unit:i.minSize[2]||"px"});var w=null;i.startSize!==void 0&&i.startSize!==null&&(w={width:i.startSize[0]||null,height:i.startSize[1]||null,unit:i.startSize[2]||"%"});var _=null;typeof i.onInitialize=="function"&&(_=i.onInitialize);var I=null;typeof i.onCropStart=="function"&&(I=i.onCropStart);var z=null;typeof i.onCropEnd=="function"&&(z=i.onCropEnd);var A=null;typeof i.onUpdate=="function"&&(console.warn("Croppr.js: `onUpdate` is deprecated and will be removed in the next major release. Please use `onCropMove` or `onCropEnd` instead."),A=i.onUpdate),typeof i.onCropMove=="function"&&(A=i.onCropMove);var F=null;if(i.returnMode!==void 0){var X=i.returnMode.toLowerCase();if(["real","ratio","raw"].indexOf(X)===-1)throw"Invalid return mode.";F=X}var j=function(G){for(var J=G.offsetWidth,ae=G.offsetHeight,we=["maxSize","minSize","startSize"],ee=0;ee<we.length;ee++){var ne=we[ee];this[ne]!==null&&(this[ne].unit=="%"&&(this[ne].width!==null&&(this[ne].width=this[ne].width/100*J),this[ne].height!==null&&(this[ne].height=this[ne].height/100*ae)),delete this[ne].unit)}},k=function(G,J){return G!==null?G:J};return{aspectRatio:k(f,l.aspectRatio),maxSize:k(u,l.maxSize),minSize:k(m,l.minSize),startSize:k(w,l.startSize),returnMode:k(F,l.returnMode),onInitialize:k(_,l.onInitialize),onCropStart:k(I,l.onCropStart),onCropMove:k(A,l.onCropMove),onCropEnd:k(z,l.onCropEnd),convertToPixels:j}}}]),S}();function W(S,c){return+(Math.round(S+"e"+c)+"e-"+c)}var re=function(S){L(c,S);function c(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return h(this,c),B(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,i,l,f))}return b(c,[{key:"getValue",value:function(l){return M(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"getValue",this).call(this,l)}},{key:"setImage",value:function(l){return M(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"setImage",this).call(this,l)}},{key:"destroy",value:function(){return M(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"destroy",this).call(this)}},{key:"moveTo",value:function(l,f){return this.box.move(l,f),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}},{key:"resizeTo",value:function(l,f){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[.5,.5];return this.box.resize(l,f,u),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}},{key:"scaleBy",value:function(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[.5,.5];return this.box.scale(l,f),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}},{key:"reset",value:function(){return this.box=this.initializeBox(this.options),this.redraw(),this.options.onCropEnd!==null&&this.options.onCropEnd(this.getValue()),this}}]),c}(V);return re})})(Ut);var Kn=Ut.exports;const Qn=Bn(Kn);var he;class qn{constructor(a){H(this,he,document.createElement("div"));P(this,"croppr");P(this,"mask",new Bt);P(this,"callback");P(this,"imageFile");P(this,"initPromise");p(this,he).classList.add("avatar-cropper"),this.imageFile=a,this.mask.onclick=()=>this.cancel(),this.initPromise=this.init()}async init(){const a=await Fn(this.imageFile);p(this,he).appendChild(a),document.body.append(p(this,he)),this.croppr=new Qn(a,{startSize:[90,60],minSize:[1,1,"px"],returnMode:"real"});const h=document.createElement("div");h.className="button-group";const b=document.createElement("div");b.innerText="Cancel",b.addEventListener("click",()=>this.cancel());const M=document.createElement("div");M.innerText="Save",M.addEventListener("click",()=>this.save()),h.append(b,M),p(this,he).appendChild(h)}cancel(){this.callback(null),this.hide()}save(){const{x:a,y:h,width:b,height:M}=this.croppr.getValue("real");this.callback([a,h,a+b,h+M]),this.hide()}hide(){p(this,he).classList.add("hide"),this.mask.hide()}async show(){return await this.initPromise,this.mask.show(),p(this,he).classList.remove("hide"),new Promise(a=>this.callback=a)}async destroy(){await this.initPromise,p(this,he).remove(),this.croppr.destroy(),this.mask.destroy()}}he=new WeakMap;var Yt={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(R,a){(function(h){R.exports=h()})(function(){return function h(b,M,L){function B(U,q){if(!M[U]){if(!b[U]){var x=typeof Ve=="function"&&Ve;if(!q&&x)return x(U,!0);if(N)return N(U,!0);var T=new Error("Cannot find module '"+U+"'");throw T.code="MODULE_NOT_FOUND",T}var V=M[U]={exports:{}};b[U][0].call(V.exports,function(W){var re=b[U][1][W];return B(re||W)},V,V.exports,h,b,M,L)}return M[U].exports}for(var N=typeof Ve=="function"&&Ve,O=0;O<L.length;O++)B(L[O]);return B}({1:[function(h,b,M){(function(L){var B=L.MutationObserver||L.WebKitMutationObserver,N;if(B){var O=0,U=new B(W),q=L.document.createTextNode("");U.observe(q,{characterData:!0}),N=function(){q.data=O=++O%2}}else if(!L.setImmediate&&typeof L.MessageChannel<"u"){var x=new L.MessageChannel;x.port1.onmessage=W,N=function(){x.port2.postMessage(0)}}else"document"in L&&"onreadystatechange"in L.document.createElement("script")?N=function(){var S=L.document.createElement("script");S.onreadystatechange=function(){W(),S.onreadystatechange=null,S.parentNode.removeChild(S),S=null},L.document.documentElement.appendChild(S)}:N=function(){setTimeout(W,0)};var T,V=[];function W(){T=!0;for(var S,c,i=V.length;i;){for(c=V,V=[],S=-1;++S<i;)c[S]();i=V.length}T=!1}b.exports=re;function re(S){V.push(S)===1&&!T&&N()}}).call(this,typeof ze<"u"?ze:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(h,b,M){var L=h(1);function B(){}var N={},O=["REJECTED"],U=["FULFILLED"],q=["PENDING"];b.exports=x;function x(u){if(typeof u!="function")throw new TypeError("resolver must be a function");this.state=q,this.queue=[],this.outcome=void 0,u!==B&&re(this,u)}x.prototype.catch=function(u){return this.then(null,u)},x.prototype.then=function(u,m){if(typeof u!="function"&&this.state===U||typeof m!="function"&&this.state===O)return this;var w=new this.constructor(B);if(this.state!==q){var _=this.state===U?u:m;V(w,_,this.outcome)}else this.queue.push(new T(w,u,m));return w};function T(u,m,w){this.promise=u,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}T.prototype.callFulfilled=function(u){N.resolve(this.promise,u)},T.prototype.otherCallFulfilled=function(u){V(this.promise,this.onFulfilled,u)},T.prototype.callRejected=function(u){N.reject(this.promise,u)},T.prototype.otherCallRejected=function(u){V(this.promise,this.onRejected,u)};function V(u,m,w){L(function(){var _;try{_=m(w)}catch(I){return N.reject(u,I)}_===u?N.reject(u,new TypeError("Cannot resolve promise with itself")):N.resolve(u,_)})}N.resolve=function(u,m){var w=S(W,m);if(w.status==="error")return N.reject(u,w.value);var _=w.value;if(_)re(u,_);else{u.state=U,u.outcome=m;for(var I=-1,z=u.queue.length;++I<z;)u.queue[I].callFulfilled(m)}return u},N.reject=function(u,m){u.state=O,u.outcome=m;for(var w=-1,_=u.queue.length;++w<_;)u.queue[w].callRejected(m);return u};function W(u){var m=u&&u.then;if(u&&(typeof u=="object"||typeof u=="function")&&typeof m=="function")return function(){m.apply(u,arguments)}}function re(u,m){var w=!1;function _(F){w||(w=!0,N.reject(u,F))}function I(F){w||(w=!0,N.resolve(u,F))}function z(){m(I,_)}var A=S(z);A.status==="error"&&_(A.value)}function S(u,m){var w={};try{w.value=u(m),w.status="success"}catch(_){w.status="error",w.value=_}return w}x.resolve=c;function c(u){return u instanceof this?u:N.resolve(new this(B),u)}x.reject=i;function i(u){var m=new this(B);return N.reject(m,u)}x.all=l;function l(u){var m=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=u.length,_=!1;if(!w)return this.resolve([]);for(var I=new Array(w),z=0,A=-1,F=new this(B);++A<w;)X(u[A],A);return F;function X(j,k){m.resolve(j).then(Z,function(G){_||(_=!0,N.reject(F,G))});function Z(G){I[k]=G,++z===w&&!_&&(_=!0,N.resolve(F,I))}}}x.race=f;function f(u){var m=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=u.length,_=!1;if(!w)return this.resolve([]);for(var I=-1,z=new this(B);++I<w;)A(u[I]);return z;function A(F){m.resolve(F).then(function(X){_||(_=!0,N.resolve(z,X))},function(X){_||(_=!0,N.reject(z,X))})}}},{1:1}],3:[function(h,b,M){(function(L){typeof L.Promise!="function"&&(L.Promise=h(2))}).call(this,typeof ze<"u"?ze:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(h,b,M){var L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function B(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function N(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var O=N();function U(){try{if(!O||!O.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),n=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||n)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function q(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(r){if(r.name!=="TypeError")throw r;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,o=new t,s=0;s<e.length;s+=1)o.append(e[s]);return o.getBlob(n.type)}}typeof Promise>"u"&&h(3);var x=Promise;function T(e,n){n&&e.then(function(t){n(null,t)},function(t){n(t)})}function V(e,n,t){typeof n=="function"&&e.then(n),typeof t=="function"&&e.catch(t)}function W(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function re(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var S="local-forage-detect-blob-support",c=void 0,i={},l=Object.prototype.toString,f="readonly",u="readwrite";function m(e){for(var n=e.length,t=new ArrayBuffer(n),o=new Uint8Array(t),s=0;s<n;s++)o[s]=e.charCodeAt(s);return t}function w(e){return new x(function(n){var t=e.transaction(S,u),o=q([""]);t.objectStore(S).put(o,"key"),t.onabort=function(s){s.preventDefault(),s.stopPropagation(),n(!1)},t.oncomplete=function(){var s=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);n(r||!s||parseInt(s[1],10)>=43)}}).catch(function(){return!1})}function _(e){return typeof c=="boolean"?x.resolve(c):w(e).then(function(n){return c=n,c})}function I(e){var n=i[e.name],t={};t.promise=new x(function(o,s){t.resolve=o,t.reject=s}),n.deferredOperations.push(t),n.dbReady?n.dbReady=n.dbReady.then(function(){return t.promise}):n.dbReady=t.promise}function z(e){var n=i[e.name],t=n.deferredOperations.pop();if(t)return t.resolve(),t.promise}function A(e,n){var t=i[e.name],o=t.deferredOperations.pop();if(o)return o.reject(n),o.promise}function F(e,n){return new x(function(t,o){if(i[e.name]=i[e.name]||ne(),e.db)if(n)I(e),e.db.close();else return t(e.db);var s=[e.name];n&&s.push(e.version);var r=O.open.apply(O,s);n&&(r.onupgradeneeded=function(d){var v=r.result;try{v.createObjectStore(e.storeName),d.oldVersion<=1&&v.createObjectStore(S)}catch(g){if(g.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+d.oldVersion+" to version "+d.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw g}}),r.onerror=function(d){d.preventDefault(),o(r.error)},r.onsuccess=function(){var d=r.result;d.onversionchange=function(v){v.target.close()},t(d),z(e)}})}function X(e){return F(e,!1)}function j(e){return F(e,!0)}function k(e,n){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,s=e.version>e.db.version;if(o&&(e.version!==n&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||t){if(t){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function Z(e){return new x(function(n,t){var o=new FileReader;o.onerror=t,o.onloadend=function(s){var r=btoa(s.target.result||"");n({__local_forage_encoded_blob:!0,data:r,type:e.type})},o.readAsBinaryString(e)})}function G(e){var n=m(atob(e.data));return q([n],{type:e.type})}function J(e){return e&&e.__local_forage_encoded_blob}function ae(e){var n=this,t=n._initReady().then(function(){var o=i[n._dbInfo.name];if(o&&o.dbReady)return o.dbReady});return V(t,e,e),t}function we(e){I(e);for(var n=i[e.name],t=n.forages,o=0;o<t.length;o++){var s=t[o];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return e.db=null,X(e).then(function(r){return e.db=r,k(e)?j(e):r}).then(function(r){e.db=n.db=r;for(var d=0;d<t.length;d++)t[d]._dbInfo.db=r}).catch(function(r){throw A(e,r),r})}function ee(e,n,t,o){o===void 0&&(o=1);try{var s=e.db.transaction(e.storeName,n);t(null,s)}catch(r){if(o>0&&(!e.db||r.name==="InvalidStateError"||r.name==="NotFoundError"))return x.resolve().then(function(){if(!e.db||r.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),j(e)}).then(function(){return we(e).then(function(){ee(e,n,t,o-1)})}).catch(t);t(r)}}function ne(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Je(e){var n=this,t={db:null};if(e)for(var o in e)t[o]=e[o];var s=i[t.name];s||(s=ne(),i[t.name]=s),s.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=ae);var r=[];function d(){return x.resolve()}for(var v=0;v<s.forages.length;v++){var g=s.forages[v];g!==n&&r.push(g._initReady().catch(d))}var y=s.forages.slice(0);return x.all(r).then(function(){return t.db=s.db,X(t)}).then(function(E){return t.db=E,k(t,n._defaultConfig.version)?j(t):E}).then(function(E){t.db=s.db=E,n._dbInfo=t;for(var C=0;C<y.length;C++){var D=y[C];D!==n&&(D._dbInfo.db=t.db,D._dbInfo.version=t.version)}})}function le(e,n){var t=this;e=W(e);var o=new x(function(s,r){t.ready().then(function(){ee(t._dbInfo,f,function(d,v){if(d)return r(d);try{var g=v.objectStore(t._dbInfo.storeName),y=g.get(e);y.onsuccess=function(){var E=y.result;E===void 0&&(E=null),J(E)&&(E=G(E)),s(E)},y.onerror=function(){r(y.error)}}catch(E){r(E)}})}).catch(r)});return T(o,n),o}function Pe(e,n){var t=this,o=new x(function(s,r){t.ready().then(function(){ee(t._dbInfo,f,function(d,v){if(d)return r(d);try{var g=v.objectStore(t._dbInfo.storeName),y=g.openCursor(),E=1;y.onsuccess=function(){var C=y.result;if(C){var D=C.value;J(D)&&(D=G(D));var Y=e(D,C.key,E++);Y!==void 0?s(Y):C.continue()}else s()},y.onerror=function(){r(y.error)}}catch(C){r(C)}})}).catch(r)});return T(o,n),o}function Oe(e,n,t){var o=this;e=W(e);var s=new x(function(r,d){var v;o.ready().then(function(){return v=o._dbInfo,l.call(n)==="[object Blob]"?_(v.db).then(function(g){return g?n:Z(n)}):n}).then(function(g){ee(o._dbInfo,u,function(y,E){if(y)return d(y);try{var C=E.objectStore(o._dbInfo.storeName);g===null&&(g=void 0);var D=C.put(g,e);E.oncomplete=function(){g===void 0&&(g=null),r(g)},E.onabort=E.onerror=function(){var Y=D.error?D.error:D.transaction.error;d(Y)}}catch(Y){d(Y)}})}).catch(d)});return T(s,t),s}function et(e,n){var t=this;e=W(e);var o=new x(function(s,r){t.ready().then(function(){ee(t._dbInfo,u,function(d,v){if(d)return r(d);try{var g=v.objectStore(t._dbInfo.storeName),y=g.delete(e);v.oncomplete=function(){s()},v.onerror=function(){r(y.error)},v.onabort=function(){var E=y.error?y.error:y.transaction.error;r(E)}}catch(E){r(E)}})}).catch(r)});return T(o,n),o}function He(e){var n=this,t=new x(function(o,s){n.ready().then(function(){ee(n._dbInfo,u,function(r,d){if(r)return s(r);try{var v=d.objectStore(n._dbInfo.storeName),g=v.clear();d.oncomplete=function(){o()},d.onabort=d.onerror=function(){var y=g.error?g.error:g.transaction.error;s(y)}}catch(y){s(y)}})}).catch(s)});return T(t,e),t}function Xe(e){var n=this,t=new x(function(o,s){n.ready().then(function(){ee(n._dbInfo,f,function(r,d){if(r)return s(r);try{var v=d.objectStore(n._dbInfo.storeName),g=v.count();g.onsuccess=function(){o(g.result)},g.onerror=function(){s(g.error)}}catch(y){s(y)}})}).catch(s)});return T(t,e),t}function tt(e,n){var t=this,o=new x(function(s,r){if(e<0){s(null);return}t.ready().then(function(){ee(t._dbInfo,f,function(d,v){if(d)return r(d);try{var g=v.objectStore(t._dbInfo.storeName),y=!1,E=g.openKeyCursor();E.onsuccess=function(){var C=E.result;if(!C){s(null);return}e===0||y?s(C.key):(y=!0,C.advance(e))},E.onerror=function(){r(E.error)}}catch(C){r(C)}})}).catch(r)});return T(o,n),o}function nt(e){var n=this,t=new x(function(o,s){n.ready().then(function(){ee(n._dbInfo,f,function(r,d){if(r)return s(r);try{var v=d.objectStore(n._dbInfo.storeName),g=v.openKeyCursor(),y=[];g.onsuccess=function(){var E=g.result;if(!E){o(y);return}y.push(E.key),E.continue()},g.onerror=function(){s(g.error)}}catch(E){s(E)}})}).catch(s)});return T(t,e),t}function jt(e,n){n=re.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,s;if(!e.name)s=x.reject("Invalid arguments");else{var r=e.name===t.name&&o._dbInfo.db,d=r?x.resolve(o._dbInfo.db):X(e).then(function(v){var g=i[e.name],y=g.forages;g.db=v;for(var E=0;E<y.length;E++)y[E]._dbInfo.db=v;return v});e.storeName?s=d.then(function(v){if(v.objectStoreNames.contains(e.storeName)){var g=v.version+1;I(e);var y=i[e.name],E=y.forages;v.close();for(var C=0;C<E.length;C++){var D=E[C];D._dbInfo.db=null,D._dbInfo.version=g}var Y=new x(function($,Q){var K=O.open(e.name,g);K.onerror=function(oe){var Ne=K.result;Ne.close(),Q(oe)},K.onupgradeneeded=function(){var oe=K.result;oe.deleteObjectStore(e.storeName)},K.onsuccess=function(){var oe=K.result;oe.close(),$(oe)}});return Y.then(function($){y.db=$;for(var Q=0;Q<E.length;Q++){var K=E[Q];K._dbInfo.db=$,z(K._dbInfo)}}).catch(function($){throw(A(e,$)||x.resolve()).catch(function(){}),$})}}):s=d.then(function(v){I(e);var g=i[e.name],y=g.forages;v.close();for(var E=0;E<y.length;E++){var C=y[E];C._dbInfo.db=null}var D=new x(function(Y,$){var Q=O.deleteDatabase(e.name);Q.onerror=function(){var K=Q.result;K&&K.close(),$(Q.error)},Q.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},Q.onsuccess=function(){var K=Q.result;K&&K.close(),Y(K)}});return D.then(function(Y){g.db=Y;for(var $=0;$<y.length;$++){var Q=y[$];z(Q._dbInfo)}}).catch(function(Y){throw(A(e,Y)||x.resolve()).catch(function(){}),Y})})}return T(s,n),s}var Vt={_driver:"asyncStorage",_initStorage:Je,_support:U(),iterate:Pe,getItem:le,setItem:Oe,removeItem:et,clear:He,length:Xe,key:tt,keys:nt,dropInstance:jt};function Gt(){return typeof openDatabase=="function"}var me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Kt="~~local_forage_type~",pt=/^~~local_forage_type~([^~]+)~/,We="__lfsc__:",rt=We.length,it="arbf",ot="blob",gt="si08",yt="ui08",wt="uic8",bt="si16",Et="si32",xt="ur16",_t="ui32",St="fl32",Ct="fl64",It=rt+it.length,Mt=Object.prototype.toString;function Tt(e){var n=e.length*.75,t=e.length,o,s=0,r,d,v,g;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);var y=new ArrayBuffer(n),E=new Uint8Array(y);for(o=0;o<t;o+=4)r=me.indexOf(e[o]),d=me.indexOf(e[o+1]),v=me.indexOf(e[o+2]),g=me.indexOf(e[o+3]),E[s++]=r<<2|d>>4,E[s++]=(d&15)<<4|v>>2,E[s++]=(v&3)<<6|g&63;return y}function at(e){var n=new Uint8Array(e),t="",o;for(o=0;o<n.length;o+=3)t+=me[n[o]>>2],t+=me[(n[o]&3)<<4|n[o+1]>>4],t+=me[(n[o+1]&15)<<2|n[o+2]>>6],t+=me[n[o+2]&63];return n.length%3===2?t=t.substring(0,t.length-1)+"=":n.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function Qt(e,n){var t="";if(e&&(t=Mt.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&Mt.call(e.buffer)==="[object ArrayBuffer]")){var o,s=We;e instanceof ArrayBuffer?(o=e,s+=it):(o=e.buffer,t==="[object Int8Array]"?s+=gt:t==="[object Uint8Array]"?s+=yt:t==="[object Uint8ClampedArray]"?s+=wt:t==="[object Int16Array]"?s+=bt:t==="[object Uint16Array]"?s+=xt:t==="[object Int32Array]"?s+=Et:t==="[object Uint32Array]"?s+=_t:t==="[object Float32Array]"?s+=St:t==="[object Float64Array]"?s+=Ct:n(new Error("Failed to get type for BinaryArray"))),n(s+at(o))}else if(t==="[object Blob]"){var r=new FileReader;r.onload=function(){var d=Kt+e.type+"~"+at(this.result);n(We+ot+d)},r.readAsArrayBuffer(e)}else try{n(JSON.stringify(e))}catch(d){console.error("Couldn't convert value into a JSON string: ",e),n(null,d)}}function qt(e){if(e.substring(0,rt)!==We)return JSON.parse(e);var n=e.substring(It),t=e.substring(rt,It),o;if(t===ot&&pt.test(n)){var s=n.match(pt);o=s[1],n=n.substring(s[0].length)}var r=Tt(n);switch(t){case it:return r;case ot:return q([r],{type:o});case gt:return new Int8Array(r);case yt:return new Uint8Array(r);case wt:return new Uint8ClampedArray(r);case bt:return new Int16Array(r);case xt:return new Uint16Array(r);case Et:return new Int32Array(r);case _t:return new Uint32Array(r);case St:return new Float32Array(r);case Ct:return new Float64Array(r);default:throw new Error("Unkown type: "+t)}}var st={serialize:Qt,deserialize:qt,stringToBuffer:Tt,bufferToString:at};function Lt(e,n,t,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,o)}function Zt(e){var n=this,t={db:null};if(e)for(var o in e)t[o]=typeof e[o]!="string"?e[o].toString():e[o];var s=new x(function(r,d){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(v){return d(v)}t.db.transaction(function(v){Lt(v,t,function(){n._dbInfo=t,r()},function(g,y){d(y)})},d)});return t.serializer=st,s}function pe(e,n,t,o,s,r){e.executeSql(t,o,s,function(d,v){v.code===v.SYNTAX_ERR?d.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[n.storeName],function(g,y){y.rows.length?r(g,v):Lt(g,n,function(){g.executeSql(t,o,s,r)},r)},r):r(d,v)},r)}function Jt(e,n){var t=this;e=W(e);var o=new x(function(s,r){t.ready().then(function(){var d=t._dbInfo;d.db.transaction(function(v){pe(v,d,"SELECT * FROM "+d.storeName+" WHERE key = ? LIMIT 1",[e],function(g,y){var E=y.rows.length?y.rows.item(0).value:null;E&&(E=d.serializer.deserialize(E)),s(E)},function(g,y){r(y)})})}).catch(r)});return T(o,n),o}function en(e,n){var t=this,o=new x(function(s,r){t.ready().then(function(){var d=t._dbInfo;d.db.transaction(function(v){pe(v,d,"SELECT * FROM "+d.storeName,[],function(g,y){for(var E=y.rows,C=E.length,D=0;D<C;D++){var Y=E.item(D),$=Y.value;if($&&($=d.serializer.deserialize($)),$=e($,Y.key,D+1),$!==void 0){s($);return}}s()},function(g,y){r(y)})})}).catch(r)});return T(o,n),o}function Rt(e,n,t,o){var s=this;e=W(e);var r=new x(function(d,v){s.ready().then(function(){n===void 0&&(n=null);var g=n,y=s._dbInfo;y.serializer.serialize(n,function(E,C){C?v(C):y.db.transaction(function(D){pe(D,y,"INSERT OR REPLACE INTO "+y.storeName+" (key, value) VALUES (?, ?)",[e,E],function(){d(g)},function(Y,$){v($)})},function(D){if(D.code===D.QUOTA_ERR){if(o>0){d(Rt.apply(s,[e,g,t,o-1]));return}v(D)}})})}).catch(v)});return T(r,t),r}function tn(e,n,t){return Rt.apply(this,[e,n,t,1])}function nn(e,n){var t=this;e=W(e);var o=new x(function(s,r){t.ready().then(function(){var d=t._dbInfo;d.db.transaction(function(v){pe(v,d,"DELETE FROM "+d.storeName+" WHERE key = ?",[e],function(){s()},function(g,y){r(y)})})}).catch(r)});return T(o,n),o}function rn(e){var n=this,t=new x(function(o,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(d){pe(d,r,"DELETE FROM "+r.storeName,[],function(){o()},function(v,g){s(g)})})}).catch(s)});return T(t,e),t}function on(e){var n=this,t=new x(function(o,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(d){pe(d,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],function(v,g){var y=g.rows.item(0).c;o(y)},function(v,g){s(g)})})}).catch(s)});return T(t,e),t}function an(e,n){var t=this,o=new x(function(s,r){t.ready().then(function(){var d=t._dbInfo;d.db.transaction(function(v){pe(v,d,"SELECT key FROM "+d.storeName+" WHERE id = ? LIMIT 1",[e+1],function(g,y){var E=y.rows.length?y.rows.item(0).key:null;s(E)},function(g,y){r(y)})})}).catch(r)});return T(o,n),o}function sn(e){var n=this,t=new x(function(o,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(d){pe(d,r,"SELECT key FROM "+r.storeName,[],function(v,g){for(var y=[],E=0;E<g.rows.length;E++)y.push(g.rows.item(E).key);o(y)},function(v,g){s(g)})})}).catch(s)});return T(t,e),t}function un(e){return new x(function(n,t){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(s,r){for(var d=[],v=0;v<r.rows.length;v++)d.push(r.rows.item(v).name);n({db:e,storeNames:d})},function(s,r){t(r)})},function(o){t(o)})})}function ln(e,n){n=re.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,s;return e.name?s=new x(function(r){var d;e.name===t.name?d=o._dbInfo.db:d=openDatabase(e.name,"","",0),e.storeName?r({db:d,storeNames:[e.storeName]}):r(un(d))}).then(function(r){return new x(function(d,v){r.db.transaction(function(g){function y(Y){return new x(function($,Q){g.executeSql("DROP TABLE IF EXISTS "+Y,[],function(){$()},function(K,oe){Q(oe)})})}for(var E=[],C=0,D=r.storeNames.length;C<D;C++)E.push(y(r.storeNames[C]));x.all(E).then(function(){d()}).catch(function(Y){v(Y)})},function(g){v(g)})})}):s=x.reject("Invalid arguments"),T(s,n),s}var cn={_driver:"webSQLStorage",_initStorage:Zt,_support:Gt(),iterate:en,getItem:Jt,setItem:tn,removeItem:nn,clear:rn,length:on,key:an,keys:sn,dropInstance:ln};function hn(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function At(e,n){var t=e.name+"/";return e.storeName!==n.storeName&&(t+=e.storeName+"/"),t}function fn(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function dn(){return!fn()||localStorage.length>0}function vn(e){var n=this,t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=At(e,n._defaultConfig),dn()?(n._dbInfo=t,t.serializer=st,x.resolve()):x.reject()}function mn(e){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo.keyPrefix,s=localStorage.length-1;s>=0;s--){var r=localStorage.key(s);r.indexOf(o)===0&&localStorage.removeItem(r)}});return T(t,e),t}function pn(e,n){var t=this;e=W(e);var o=t.ready().then(function(){var s=t._dbInfo,r=localStorage.getItem(s.keyPrefix+e);return r&&(r=s.serializer.deserialize(r)),r});return T(o,n),o}function gn(e,n){var t=this,o=t.ready().then(function(){for(var s=t._dbInfo,r=s.keyPrefix,d=r.length,v=localStorage.length,g=1,y=0;y<v;y++){var E=localStorage.key(y);if(E.indexOf(r)===0){var C=localStorage.getItem(E);if(C&&(C=s.serializer.deserialize(C)),C=e(C,E.substring(d),g++),C!==void 0)return C}}});return T(o,n),o}function yn(e,n){var t=this,o=t.ready().then(function(){var s=t._dbInfo,r;try{r=localStorage.key(e)}catch{r=null}return r&&(r=r.substring(s.keyPrefix.length)),r});return T(o,n),o}function wn(e){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo,s=localStorage.length,r=[],d=0;d<s;d++){var v=localStorage.key(d);v.indexOf(o.keyPrefix)===0&&r.push(v.substring(o.keyPrefix.length))}return r});return T(t,e),t}function bn(e){var n=this,t=n.keys().then(function(o){return o.length});return T(t,e),t}function En(e,n){var t=this;e=W(e);var o=t.ready().then(function(){var s=t._dbInfo;localStorage.removeItem(s.keyPrefix+e)});return T(o,n),o}function xn(e,n,t){var o=this;e=W(e);var s=o.ready().then(function(){n===void 0&&(n=null);var r=n;return new x(function(d,v){var g=o._dbInfo;g.serializer.serialize(n,function(y,E){if(E)v(E);else try{localStorage.setItem(g.keyPrefix+e,y),d(r)}catch(C){(C.name==="QuotaExceededError"||C.name==="NS_ERROR_DOM_QUOTA_REACHED")&&v(C),v(C)}})})});return T(s,t),s}function _n(e,n){if(n=re.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var o=this,s;return e.name?s=new x(function(r){e.storeName?r(At(e,o._defaultConfig)):r(e.name+"/")}).then(function(r){for(var d=localStorage.length-1;d>=0;d--){var v=localStorage.key(d);v.indexOf(r)===0&&localStorage.removeItem(v)}}):s=x.reject("Invalid arguments"),T(s,n),s}var Sn={_driver:"localStorageWrapper",_initStorage:vn,_support:hn(),iterate:gn,getItem:pn,setItem:xn,removeItem:En,clear:mn,length:bn,key:yn,keys:wn,dropInstance:_n},Cn=function(n,t){return n===t||typeof n=="number"&&typeof t=="number"&&isNaN(n)&&isNaN(t)},In=function(n,t){for(var o=n.length,s=0;s<o;){if(Cn(n[s],t))return!0;s++}return!1},Pt=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},De={},Ot={},Se={INDEXEDDB:Vt,WEBSQL:cn,LOCALSTORAGE:Sn},Mn=[Se.INDEXEDDB._driver,Se.WEBSQL._driver,Se.LOCALSTORAGE._driver],je=["dropInstance"],ut=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(je),Tn={description:"",driver:Mn.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ln(e,n){e[n]=function(){var t=arguments;return e.ready().then(function(){return e[n].apply(e,t)})}}function lt(){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var t in n)n.hasOwnProperty(t)&&(Pt(n[t])?arguments[0][t]=n[t].slice():arguments[0][t]=n[t])}return arguments[0]}var Rn=function(){function e(n){B(this,e);for(var t in Se)if(Se.hasOwnProperty(t)){var o=Se[t],s=o._driver;this[t]=s,De[s]||this.defineDriver(o)}this._defaultConfig=lt({},Tn),this._config=lt({},this._defaultConfig,n),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":L(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var o in t){if(o==="storeName"&&(t[o]=t[o].replace(/\W/g,"_")),o==="version"&&typeof t[o]!="number")return new Error("Database version must be a number.");this._config[o]=t[o]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,o,s){var r=new x(function(d,v){try{var g=t._driver,y=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){v(y);return}for(var E=ut.concat("_initStorage"),C=0,D=E.length;C<D;C++){var Y=E[C],$=!In(je,Y);if(($||t[Y])&&typeof t[Y]!="function"){v(y);return}}var Q=function(){for(var Ne=function(On){return function(){var Dn=new Error("Method "+On+" is not implemented by the current driver"),Dt=x.reject(Dn);return T(Dt,arguments[arguments.length-1]),Dt}},ct=0,Pn=je.length;ct<Pn;ct++){var ht=je[ct];t[ht]||(t[ht]=Ne(ht))}};Q();var K=function(Ne){De[g]&&console.info("Redefining LocalForage driver: "+g),De[g]=t,Ot[g]=Ne,d()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(K,v):K(!!t._support):K(!0)}catch(oe){v(oe)}});return V(r,o,s),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,o,s){var r=De[t]?x.resolve(De[t]):x.reject(new Error("Driver not found."));return V(r,o,s),r},e.prototype.getSerializer=function(t){var o=x.resolve(st);return V(o,t),o},e.prototype.ready=function(t){var o=this,s=o._driverSet.then(function(){return o._ready===null&&(o._ready=o._initDriver()),o._ready});return V(s,t,t),s},e.prototype.setDriver=function(t,o,s){var r=this;Pt(t)||(t=[t]);var d=this._getSupportedDrivers(t);function v(){r._config.driver=r.driver()}function g(C){return r._extend(C),v(),r._ready=r._initStorage(r._config),r._ready}function y(C){return function(){var D=0;function Y(){for(;D<C.length;){var $=C[D];return D++,r._dbInfo=null,r._ready=null,r.getDriver($).then(g).catch(Y)}v();var Q=new Error("No available storage method found.");return r._driverSet=x.reject(Q),r._driverSet}return Y()}}var E=this._driverSet!==null?this._driverSet.catch(function(){return x.resolve()}):x.resolve();return this._driverSet=E.then(function(){var C=d[0];return r._dbInfo=null,r._ready=null,r.getDriver(C).then(function(D){r._driver=D._driver,v(),r._wrapLibraryMethodsWithReady(),r._initDriver=y(d)})}).catch(function(){v();var C=new Error("No available storage method found.");return r._driverSet=x.reject(C),r._driverSet}),V(this._driverSet,o,s),this._driverSet},e.prototype.supports=function(t){return!!Ot[t]},e.prototype._extend=function(t){lt(this,t)},e.prototype._getSupportedDrivers=function(t){for(var o=[],s=0,r=t.length;s<r;s++){var d=t[s];this.supports(d)&&o.push(d)}return o},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,o=ut.length;t<o;t++)Ln(this,ut[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),An=new Rn;b.exports=An},{3:3}]},{},[4])(4)})})(Yt);var Nt=Yt.exports;const mt=R=>{R.stopPropagation(),R.preventDefault()};var ie,ge,ye,Ye,Qe;class Zn{constructor(a){P(this,"type");H(this,ie,document.createElement("label"));H(this,ge,void 0);H(this,ye,void 0);H(this,Ye,void 0);H(this,Qe,new Promise(a=>te(this,Ye,a)));P(this,"cropPos");this.type=a,p(this,ie).title=de().rightClickOrLongPress,p(this,ie).setAttribute("type",a),p(this,ie).addEventListener("dragenter",mt,!1),p(this,ie).addEventListener("dragover",mt,!1),p(this,ie).addEventListener("drop",b=>{mt(b),this.setFiles(b.dataTransfer.files)},!1),p(this,ie).addEventListener("contextmenu",async b=>{if(b.preventDefault(),!p(this,ge))return;const M=this.cropPos,L=new qn(p(this,ge));this.cropPos=await L.show(),await L.destroy(),this.cropPos!==M&&p(this,ye)&&p(this,ye).call(this,this)});const h=document.createElement("input");h.type="file",h.accept="image/*",h.addEventListener("change",()=>this.setFiles(h.files)),p(this,ie).appendChild(h),Nt.getItem(this.type).then(b=>{this.setFile(b)})}render(){return p(this,ie)}set onchange(a){te(this,ye,a)}get file(){return p(this,ge)}async waitFile(){return await p(this,Qe),p(this,ge)}setFiles(a){let h=a.item(0);this.setFile(h)}setFile(a){if(a){if(!a.type.startsWith("image"))throw new Error("ä»…æ”¯æŒå›¾ç‰‡æ ¼å¼");p(this,ie).style.backgroundImage=`url(${URL.createObjectURL(a)})`,p(this,ie).style.backgroundSize="cover",te(this,ge,a),p(this,Ye).call(this),this.cropPos=void 0,p(this,ye)&&p(this,ye).call(this,this),Nt.setItem(this.type,a)}}}ie=new WeakMap,ge=new WeakMap,ye=new WeakMap,Ye=new WeakMap,Qe=new WeakMap;const $t={workers:2,quality:10,background:"#ffffff",dither:!1};async function Jn(R,a){const h=new kn($t);return R.forEach(b=>h.addFrame(b,{delay:a})),new Promise(b=>{h.on("finished",b),h.render()})}const zt=["FROM","TO","BOT","GROUP"];var fe,$e,ue;class Ht{constructor(){H(this,fe,void 0);H(this,$e,new Map(zt.map(a=>[a,new Zn(a)])));H(this,ue,void 0);te(this,fe,document.createElement("div")),p(this,fe).className="avatar-uploader",p(this,fe).innerHTML=de().noAvatar}set types(a){if(!a||a.length===0){p(this,fe).innerHTML=de().noAvatar;return}p(this,fe).innerHTML="",te(this,ue,a.map(h=>p(this,$e).get(h))),p(this,fe).append(...p(this,ue).map(h=>h.render()))}render(){const a=document.createElement("div");return a.append(Ae(de().uploadAvatar),p(this,fe)),a}get ready(){var a;return(a=p(this,ue))!=null&&a.length?p(this,ue).some(h=>h.file):!0}set onchange(a){for(const h of p(this,$e).values())h.onchange=()=>this.ready&&a(this)}get data(){var h;const a={};if(!((h=p(this,ue))!=null&&h.length))return a;for(const b of p(this,ue))a[b.type.toLowerCase()]=b.file;return a}get extraTemplate(){var b;const a={};let h=!1;if(!((b=p(this,ue))!=null&&b.length))return a;for(const M of p(this,ue))h=h||!!M.cropPos,a[M.type.toLowerCase()]={cropType:Un.PIXEL,crop:M.cropPos};return h?a:void 0}}fe=new WeakMap,$e=new WeakMap,ue=new WeakMap,P(Ht,"types",zt);class er{constructor(){P(this,"textModels");P(this,"textDomList",document.createElement("div"));P(this,"settingDom",new Be({add:()=>this.addTextModel()}).render());this.textDomList.appendChild(this.settingDom)}set texts(a){this.textModels=a,this.textDomList.innerHTML="",this.textDomList.appendChild(this.settingDom);for(let h of this.textModels.texts)this.addTextModel(h)}addTextModel(a=this.textModels.addTextModel()){const h=new Be(a.settingObject,a.settingAttributes,`Text - ${this.textModels.texts.length}`);this.textDomList.appendChild(h.render())}render(){const a=document.createElement("div");return a.append(Ae(de().setText),this.textDomList),a}}var Le,ve,xe,Re,_e,qe,Xt,Ze,Wt;class tr{constructor(){H(this,qe);H(this,Ze);H(this,Le,document.createElement("div"));H(this,ve,document.createElement("div"));H(this,xe,document.createElement("canvas"));H(this,Re,void 0);H(this,_e,void 0);p(this,ve).className="result-area",p(this,Le).append(Ae(de().result),p(this,ve)),dt(this,qe,Xt).call(this),p(this,ve).appendChild(p(this,xe)),te(this,_e,new Ft(p(this,ve))),p(this,_e).show()}set canvas(a){p(this,ve).innerHTML="",te(this,xe,a),p(this,ve).appendChild(a),dt(this,Ze,Wt).call(this),p(this,_e).hide()}set setting(a){p(this,Re)&&p(this,Re).remove(),te(this,Re,a),p(this,Le).appendChild(a)}showLoading(){p(this,_e).show()}render(){return p(this,Le)}}Le=new WeakMap,ve=new WeakMap,xe=new WeakMap,Re=new WeakMap,_e=new WeakMap,qe=new WeakSet,Xt=function(){p(this,xe).classList.add("hide")},Ze=new WeakSet,Wt=function(){p(this,xe).classList.remove("hide")};class Ke{constructor(a){P(this,"initPromise");P(this,"viewer");P(this,"frames");P(this,"cache");P(this,"prevFramesCache");P(this,"downloadOptions",{download:async()=>await this.download(),copy:async()=>await this.copy(),share:async()=>await this.share()});this.viewer=a,this.initPromise=this.init()}async init(){this.frames=await this.viewer.getFrames()}async getTextFrames(){return await this.viewer.getTextedFrames()}async renderAsync(){await this.initPromise;const a=document.createElement("div");if(this.frames.length!==1){const b=new Be($t,{quality:{type:"range",min:"1",max:"20",className:"reversed"}},"GIF Render");a.appendChild(b.render())}const h=new Be(this.downloadOptions,void 0,"Save & Share");return a.append(h.render()),a}async getOptions(){await this.initPromise;const a=await this.getTextFrames();if(this.cache&&this.prevFramesCache===a)return this.cache;if(!this.frames)return;if(this.prevFramesCache=a,a.length===1)return this.cache={blob:await new Promise(b=>a[0].toBlob(M=>b(M))),fileName:`${this.viewer.template.key}.png`},this.cache;const h=this.viewer.delay;return this.cache={blob:await Jn(h>0?a:a.reverse(),Math.abs(h)),fileName:`${this.viewer.template.key}.gif`},this.cache}async download(){const{blob:a,fileName:h}=await this.getOptions();Ke.download(a,h)}async copy(){const{blob:a}=await this.getOptions();if(this.frames.length===1){await Ke.copy(a);return}const h=URL.createObjectURL(a),b=`width=${this.frames[0].width}, height=${this.frames[0].height}`;window.open(h,void 0,b),setTimeout(()=>{URL.revokeObjectURL(h)},3e3)}async share(){const{blob:a,fileName:h}=await this.getOptions(),b=new File([a],h,{type:a.type});await navigator.share({url:document.location.href,title:h,files:[b]})}static download(a,h){const b=URL.createObjectURL(a),M=document.createElement("a");M.href=b,M.download=h,document.body.appendChild(M),M.click(),document.body.removeChild(M),setTimeout(()=>{URL.revokeObjectURL(b)},1e4)}static async copy(a){try{await navigator.clipboard.write([new ClipboardItem({[a.type]:a})])}catch(h){console.error(h,h.message)}}}class nr{constructor(a){P(this,"appElement");P(this,"templateChooser");P(this,"avatarUploader");P(this,"textUploader");P(this,"resultArea");P(this,"inputElement",document.createElement("div"));P(this,"outputElement",document.createElement("div"));P(this,"prevTemplate");P(this,"initPromise");P(this,"backgroundLengthMap");P(this,"viewer");this.appElement=document.getElementById(a),this.appElement.classList.add("petpet-app"),this.templateChooser=new Gn,this.templateChooser.onchange=()=>this.update(),this.avatarUploader=new Ht,this.avatarUploader.onchange=()=>this.update(),this.textUploader=new er,this.inputElement.append(this.templateChooser.render(),this.avatarUploader.render(),this.textUploader.render()),this.resultArea=new tr,this.outputElement.appendChild(this.resultArea.render()),this.outputElement.style.display="none",this.appElement.append(this.inputElement,this.outputElement),this.initPromise=this.init(),this.update()}async init(){Hn();const a=new Vn(vt.server);this.backgroundLengthMap=await a.getLengthMap(),this.templateChooser.templates=await a.getPreviewList(),await this.templateChooser.setTemplate(vt.template),(await a.getUrlSet()).size||this.templateChooser.loading.error()}async update(){var O,U;await this.initPromise,this.viewer&&this.viewer.destroy();const a=this.templateChooser.template||await this.templateChooser.showModal();if(!a)return;const h=this.templateChooser.templateKey;if(vt.template=h,Yn("template",h),this.prevTemplate!==a&&(this.avatarUploader.types=[...new Set((O=a.avatar)==null?void 0:O.map(q=>q.type))]),(U=a.avatar)!=null&&U.length&&!this.avatarUploader.ready){this.outputElement.style.display="none";return}this.outputElement.style.display="flex",this.resultArea.showLoading();const b=new $n(a);b.backgroundLength=this.backgroundLengthMap.get(a.key),b.background=a.url;const M=await b.generate(this.avatarUploader.data,this.avatarUploader.extraTemplate);this.textUploader.texts=b.textModelList,await M.play(),this.resultArea.canvas=M.canvas;const L=document.createElement("div");this.resultArea.setting=L;const B=new Be(M.settingObject,{delay:{type:"range",min:"1",max:"256",step:"1"}});L.appendChild(B.render());const N=new Ke(M);L.appendChild(await N.renderAsync()),this.prevTemplate=a,this.viewer=M}}new nr("app");
